(function(n,t,i,r,u){function f(n){return i.translate(n)||n}function o(n){n.id=n.attr("id");n.html('<div class="plupload_wrapper"><div class="ui-widget-content plupload_container"><div class="ui-state-default ui-widget-header plupload_header"><div class="plupload_header_content"><div class="plupload_logo"> <\/div><div class="plupload_header_title">'+f("Select files")+'<\/div><div class="plupload_header_text">'+f("Add files to the upload queue and click the start button.")+'<\/div><div class="plupload_view_switch"><input type="radio" id="'+n.id+'_view_list" name="view_mode_'+n.id+'" checked="checked" /><label class="plupload_button" for="'+n.id+'_view_list" data-view="list">'+f("List")+'<\/label><input type="radio" id="'+n.id+'_view_thumbs" name="view_mode_'+n.id+'" /><label class="plupload_button"  for="'+n.id+'_view_thumbs" data-view="thumbs">'+f("Thumbnails")+'<\/label><\/div><\/div><\/div><table class="plupload_filelist plupload_filelist_header ui-widget-header"><tr><td class="plupload_cell plupload_file_name">'+f("Filename")+'<\/td><td class="plupload_cell plupload_file_status">'+f("Status")+'<\/td><td class="plupload_cell plupload_file_size">'+f("Size")+'<\/td><td class="plupload_cell plupload_file_action">&nbsp;<\/td><\/tr><\/table><div class="plupload_content"><div class="plupload_droptext">'+f("Drag files here.")+'<\/div><ul class="plupload_filelist_content"> <\/ul><div class="plupload_clearer">&nbsp;<\/div><\/div><table class="plupload_filelist plupload_filelist_footer ui-widget-header"><tr><td class="plupload_cell plupload_file_name"><div class="plupload_buttons"><!-- Visible --><a class="plupload_button plupload_add">'+f("Add Files")+'<\/a>&nbsp;<a class="plupload_button plupload_start">'+f("Start Upload")+'<\/a>&nbsp;<a class="plupload_button plupload_stop plupload_hidden">'+f("Stop Upload")+'<\/a>&nbsp;<\/div><div class="plupload_started plupload_hidden"><!-- Hidden --><div class="plupload_progress plupload_right"><div class="plupload_progress_container"><\/div><\/div><div class="plupload_cell plupload_upload_status"><\/div><div class="plupload_clearer">&nbsp;<\/div><\/div><\/td><td class="plupload_file_status"><span class="plupload_total_status">0%<\/span><\/td><td class="plupload_file_size"><span class="plupload_total_file_size">0 kb<\/span><\/td><td class="plupload_file_action"><\/td><\/tr><\/table><\/div><input class="plupload_count" value="0" type="hidden"><\/div>')}var e={};u.widget("ui.plupload",{widgetEventPrefix:"",contents_bak:"",options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",dragdrop:!0,multiple_queues:!0,buttons:{browse:!0,start:!0,stop:!0},views:{list:!0,thumbs:!1,active:"list",remember:!0},autostart:!1,sortable:!1,rename:!1,max_file_count:0},FILE_COUNT_ERROR:-9001,_create:function(){var n=this.element.attr("id");n||(n=i.guid(),this.element.attr("id",n));this.id=n;this.contents_bak=this.element.html();o(this.element);this.container=u(".plupload_container",this.element).attr("id",n+"_container");this.content=u(".plupload_content",this.element);u.fn.resizable&&this.container.resizable({handles:"s",minHeight:300});this.filelist=u(".plupload_filelist_content",this.container).attr({id:n+"_filelist",unselectable:"on"});this.browse_button=u(".plupload_add",this.container).attr("id",n+"_browse");this.start_button=u(".plupload_start",this.container).attr("id",n+"_start");this.stop_button=u(".plupload_stop",this.container).attr("id",n+"_stop");this.thumbs_switcher=u("#"+n+"_view_thumbs");this.list_switcher=u("#"+n+"_view_list");u.ui.button&&(this.browse_button.button({icons:{primary:"ui-icon-circle-plus"},disabled:!0}),this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:!0}),this.stop_button.button({icons:{primary:"ui-icon-circle-close"}}),this.list_switcher.button({text:!1,icons:{secondary:"ui-icon-grip-dotted-horizontal"}}),this.thumbs_switcher.button({text:!1,icons:{secondary:"ui-icon-image"}}));this.progressbar=u(".plupload_progress_container",this.container);u.ui.progressbar&&this.progressbar.progressbar();this.counter=u(".plupload_count",this.element).attr({id:n+"_count",name:n+"_count"});this._initUploader()},_initUploader:function(){var n=this,o=this.id,t,s={container:o+"_buttons",browse_button:o+"_browse"};u(".plupload_buttons",this.element).attr("id",o+"_buttons");n.options.dragdrop&&(this.filelist.parent().attr("id",this.id+"_dropbox"),s.drop_element=this.id+"_dropbox");t=this.uploader=e[o]=new i.Uploader(u.extend(this.options,s));n.options.views.thumbs&&(t.settings.required_features.display_media=!0);t.bind("Error",function(t,u){var o,e="";o="<strong>"+u.message+"<\/strong>";switch(u.code){case i.FILE_EXTENSION_ERROR:e=r.sprintf(f("File: %s"),u.file.name);break;case i.FILE_SIZE_ERROR:e=r.sprintf(f("File: %s, size: %d, max file size: %d"),u.file.name,u.file.size,i.parseSize(n.options.max_file_size));break;case i.FILE_DUPLICATE_ERROR:e=r.sprintf(f("%s already present in the queue."),u.file.name);break;case n.FILE_COUNT_ERROR:e=r.sprintf(f("Upload element accepts only %d file(s) at a time. Extra files were stripped."),n.options.max_file_count);break;case i.IMAGE_FORMAT_ERROR:e=f("Image format either wrong or not supported.");break;case i.IMAGE_MEMORY_ERROR:e=f("Runtime ran out of available memory.");break;case i.HTTP_ERROR:e=f("Upload URL might be wrong or doesn't exist.")}o+=" <br /><i>"+e+"<\/i>";n._trigger("error",null,{up:t,error:u});u.code===i.INIT_ERROR?setTimeout(function(){n.destroy()},1):n.notify("error",o)});t.bind("PostInit",function(t){n.options.buttons.browse?n.browse_button.button("enable"):(n.browse_button.button("disable").hide(),t.disableBrowse(!0));n.options.buttons.start||n.start_button.button("disable").hide();n.options.buttons.stop||n.stop_button.button("disable").hide();!n.options.unique_names&&n.options.rename&&n._enableRenaming();n.options.dragdrop&&t.features.dragdrop&&n.filelist.parent().addClass("plupload_dropbox");n._enableViewSwitcher();n.start_button.click(function(t){u(this).button("option","disabled")||n.start();t.preventDefault()});n.stop_button.click(function(t){n.stop();t.preventDefault()});n._trigger("ready",null,{up:t})});n.options.max_file_count&&(n.options.multiple_queues=!1,t.bind("FilesAdded",function(t,i){var u=i.length,r=t.files.length+u-n.options.max_file_count;r>0&&(i.splice(u-r,r),t.trigger("Error",{code:n.FILE_COUNT_ERROR,message:f("File count error.")}))}));t.init();t.bind("FileFiltered",function(t,i){n._addFiles(i)});t.bind("FilesAdded",function(t,i){n._trigger("selected",null,{up:t,files:i});n.options.sortable&&u.ui.sortable&&n._enableSortingList();n._trigger("updatelist",null,{filelist:n.filelist});n.options.autostart&&setTimeout(function(){n.start()},10)});t.bind("FilesRemoved",function(t,i){n._trigger("removed",null,{up:t,files:i})});t.bind("QueueChanged StateChanged",function(){n._handleState()});t.bind("UploadFile",function(t,i){n._handleFileStatus(i)});t.bind("FileUploaded",function(t,i){n._handleFileStatus(i);n._trigger("uploaded",null,{up:t,file:i})});t.bind("UploadProgress",function(t,i){n._handleFileStatus(i);n._updateTotalProgress();n._trigger("progress",null,{up:t,file:i})});t.bind("UploadComplete",function(t,i){n._addFormFields();n._trigger("complete",null,{up:t,files:i})})},_setOption:function(n,t){var i=this;n=="buttons"&&typeof t=="object"&&(t=u.extend(i.options.buttons,t),t.browse?(i.browse_button.button("enable").show(),i.uploader.disableBrowse(!1)):(i.browse_button.button("disable").hide(),i.uploader.disableBrowse(!0)),t.start?i.start_button.button("enable").show():i.start_button.button("disable").hide(),t.stop?i.start_button.button("enable").show():i.stop_button.button("disable").hide());i.uploader.settings[n]=t},start:function(){this.uploader.start();this._trigger("start",null,{up:this.uploader})},stop:function(){this.uploader.stop();this._trigger("stop",null,{up:this.uploader})},enable:function(){this.browse_button.button("enable");this.uploader.disableBrowse(!1)},disable:function(){this.browse_button.button("disable");this.uploader.disableBrowse(!0)},getFile:function(n){return typeof n=="number"?this.uploader.files[n]:this.uploader.getFile(n)},getFiles:function(){return this.uploader.files},removeFile:function(n){i.typeOf(n)==="string"&&(n=this.getFile(n));this._removeFiles(n)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},notify:function(n,t){var i=u('<div class="plupload_message"><span class="plupload_message_close ui-icon ui-icon-circle-close" title="'+f("Close")+'"><\/span><p><span class="ui-icon"><\/span>'+t+"<\/p><\/div>");i.addClass("ui-state-"+(n==="error"?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+(n==="error"?"alert":"info")).end().find(".plupload_message_close").click(function(){i.remove()}).end();u(".plupload_header",this.container).append(i)},destroy:function(){this._removeFiles([].slice.call(this.uploader.files));this.uploader.destroy();u(".plupload_button",this.element).unbind();u.ui.button&&u(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy");u.ui.progressbar&&this.progressbar.progressbar("destroy");u.ui.sortable&&this.options.sortable&&u("tbody",this.filelist).sortable("destroy");this.element.empty().html(this.contents_bak);this.contents_bak="";u.Widget.prototype.destroy.apply(this)},_handleState:function(){var n=this.uploader;n.state===i.STARTED?(u(this.start_button).button("disable"),u([]).add(this.stop_button).add(".plupload_started").removeClass("plupload_hidden"),u(".plupload_upload_status",this.element).html(r.sprintf(f("Uploaded %d/%d files"),n.total.uploaded,n.files.length)),u(".plupload_header_content",this.element).addClass("plupload_header_content_bw")):n.state===i.STOPPED&&(u([]).add(this.stop_button).add(".plupload_started").addClass("plupload_hidden"),this.options.multiple_queues?u(".plupload_header_content",this.element).removeClass("plupload_header_content_bw"):(u([]).add(this.browse_button).add(this.start_button).button("disable"),n.disableBrowse()),n.files.length===n.total.uploaded+n.total.failed?this.start_button.button("disable"):this.start_button.button("enable"),this._updateTotalProgress());n.total.queued===0?u(".ui-button-text",this.browse_button).html(f("Add Files")):u(".ui-button-text",this.browse_button).html(r.sprintf(f("%d files queued"),n.total.queued));n.refresh()},_handleFileStatus:function(n){var s=this,t,r;if(u("#"+n.id).length){switch(n.status){case i.DONE:t="plupload_done";r="ui-icon ui-icon-circle-check";break;case i.FAILED:t="ui-state-error plupload_failed";r="ui-icon ui-icon-alert";break;case i.QUEUED:t="plupload_delete";r="ui-icon ui-icon-circle-minus";break;case i.UPLOADING:t="ui-state-highlight plupload_uploading";r="ui-icon ui-icon-circle-arrow-w";var f=u(".plupload_scroll",this.container),h=f.scrollTop(),e=f.height(),o=u("#"+n.id).position().top+u("#"+n.id).height();e<o&&f.scrollTop(h+o-e);u("#"+n.id).find(".plupload_file_percent").html(n.percent+"%").end().find(".plupload_file_progress").css("width",n.percent+"%").end().find(".plupload_file_size").html(i.formatSize(n.size))}t+=" ui-state-default plupload_file";u("#"+n.id).attr("class",t).find(".ui-icon").attr("class",r).end().filter(".plupload_delete, .plupload_done, .plupload_failed").find(".ui-icon").click(function(t){s._removeFiles(n);t.preventDefault()})}},_updateTotalProgress:function(){var n=this.uploader;this.filelist[0].scrollTop=this.filelist[0].scrollHeight;this.progressbar.progressbar("value",n.total.percent);this.element.find(".plupload_total_status").html(n.total.percent+"%").end().find(".plupload_total_file_size").html(i.formatSize(n.total.size)).end().find(".plupload_upload_status").html(r.sprintf(f("Uploaded %d/%d files"),n.total.uploaded,n.files.length))},_displayThumbs:function(){function s(n,t,i){var r;n.on(t,function(){clearTimeout(r);r=setTimeout(function(){clearTimeout(r);i()},300)})}function a(){var r,e,o;i&&t||(r=u(".plupload_file:eq(0)",n.filelist),i=r.outerWidth(!0),t=r.outerHeight(!0));e=n.content.width();o=n.content.height();f=Math.floor(e/i);h=f*(Math.ceil(o/t)+1)}function c(){var i=Math.floor(n.content.scrollTop()/t)*f;e=u(".plupload_file",n.filelist).slice(i,i+h).filter(":not(.plupload_file_thumb_loaded)").get()}function v(){function t(){n.view_mode==="thumbs"&&(a(),c(),l())}u.fn.resizable&&s(n.container,"resize",t);s(n.window,"resize",t);s(n.content,"scroll",t);n.element.on("viewchanged selected",t);t()}function y(t,i){var f=new r.Image;f.onload=function(){var i=u("#"+t.id+" .plupload_file_thumb",n.filelist).html("");this.embed(i[0],{width:100,height:60,crop:!0,swf_url:r.resolveUrl(n.options.flash_swf_url),xap_url:r.resolveUrl(n.options.silverlight_xap_url)})};f.bind("embedded error",function(){u("#"+t.id,n.filelist).addClass("plupload_file_thumb_loaded");this.destroy();setTimeout(i,1)});f.load(t.getSource())}function l(){n.view_mode!=="thumbs"||o||(c(),e.length)&&(o=!0,y(n.getFile(u(e.shift()).attr("id")),function(){o=!1;l()}))}var n=this,i,t,f,h=0,e=[],o=!1;if(this.options.views.thumbs)this.element.on("selected",function p(){n.element.off("selected",p);v()})},_addFiles:function(n){var t=this,f;f='<li class="plupload_file ui-state-default" id="%id%"><div class="plupload_file_thumb"><div class="plupload_file_dummy ui-widget-content"><span class="ui-state-disabled">%ext%<\/span><\/div><\/div><div class="plupload_file_name" title="%name%"><span class="plupload_file_namespan">%name%<\/span><\/div><div class="plupload_file_action"><div class="ui-icon"> <\/div><\/div><div class="plupload_file_size">%size% <\/div><div class="plupload_file_status"><div class="plupload_file_progress ui-widget-header" style="width: 0%"> <\/div><span class="plupload_file_percent">%percent% <\/span><\/div><div class="plupload_file_fields"> <\/div><\/li>';i.typeOf(n)!=="array"&&(n=[n]);u.each(n,function(n,u){var e=r.Mime.getFileExtension(u.name)||"none";t.filelist.append(f.replace(/%(\w+)%/g,function(n,t){return"size"===t?i.formatSize(u.size):"ext"===t?e:u[t]||""}));t._handleFileStatus(u)})},_removeFiles:function(n){var r=this,t=this.uploader;i.typeOf(n)!=="array"&&(n=[n]);u.ui.sortable&&this.options.sortable&&u("tbody",r.filelist).sortable("destroy");u.each(n,function(n,i){u("#"+i.id).toggle("highlight",function(){this.remove()});t.removeFile(i)});t.files.length&&this.options.sortable&&u.ui.sortable&&this._enableSortingList();this._trigger("updatelist",null,{filelist:this.filelist})},_addFormFields:function(){var n=this;u(".plupload_file_fields",this.filelist).html("");i.each(this.uploader.files,function(t,r){var f="",e=n.id+"_"+r;t.target_name&&(f+='<input type="hidden" name="'+e+'_tmpname" value="'+i.xmlEncode(t.target_name)+'" />');f+='<input type="hidden" name="'+e+'_name" value="'+i.xmlEncode(t.name)+'" />';f+='<input type="hidden" name="'+e+'_status" value="'+(t.status===i.DONE?"done":"failed")+'" />';u("#"+t.id).find(".plupload_file_fields").html(f)});this.counter.val(this.uploader.files.length)},_viewChanged:function(n){this.options.views.remember&&u.cookie&&u.cookie("plupload_ui_view",n,{expires:7,path:"/"});r.Env.browser==="IE"&&r.Env.version<7&&this.content.attr("style",'height:expression(document.getElementById("'+this.id+'_container").clientHeight - '+(n==="list"?133:103)+");");this.container.removeClass("plupload_view_list plupload_view_thumbs").addClass("plupload_view_"+n);this.view_mode=n;this._trigger("viewchanged",null,{view:n})},_enableViewSwitcher:function(){var r=this,n,t=u(".plupload_view_switch",this.container),f,e;i.each(["list","thumbs"],function(n){r.options.views[n]||t.find('[for="'+r.id+"_view_"+n+'"], #'+r.id+"_view_"+n).remove()});f=t.find(".plupload_button");f.length===1?(t.hide(),n=f.eq(0).data("view"),this._viewChanged(n)):u.ui.button&&f.length>1?(this.options.views.remember&&u.cookie&&(n=u.cookie("plupload_ui_view")),~i.inArray(n,["list","thumbs"])||(n=this.options.views.active),t.show().buttonset().find(".ui-button").click(function(t){n=u(this).data("view");r._viewChanged(n);t.preventDefault()}),e=t.find('[for="'+r.id+"_view_"+n+'"]'),e.length&&e.trigger("click")):(t.show(),this._viewChanged(this.options.views.active));this.options.views.thumbs&&this._displayThumbs()},_enableRenaming:function(){var n=this;this.filelist.dblclick(function(t){var i=u(t.target),o,r,f,e,s="";i.hasClass("plupload_file_namespan")&&(r=n.uploader.getFile(i.closest(".plupload_file")[0].id),e=r.name,f=/^(.+)(\.[^.]+)$/.exec(e),f&&(e=f[1],s=f[2]),o=u('<input class="plupload_file_rename" type="text" />').width(i.width()).insertAfter(i.hide()),o.val(e).blur(function(){i.show().parent().scrollLeft(0).end().next().remove()}).keydown(function(n){var t=u(this);u.inArray(n.keyCode,[13,27])!==-1&&(n.preventDefault(),n.keyCode===13&&(r.name=t.val()+s,i.html(r.name)),t.blur())})[0].focus())})},_enableSortingList:function(){var n=this;u(".plupload_file",this.filelist).length<2||(u("tbody",this.filelist).sortable("destroy"),this.filelist.sortable({items:".plupload_delete",cancel:"object, .plupload_clearer",stop:function(){var t=[];u.each(u(this).sortable("toArray"),function(i,r){t[t.length]=n.uploader.getFile(r)});t.unshift(t.length);t.unshift(0);Array.prototype.splice.apply(n.uploader.files,t)}}))}})})(window,document,plupload,mOxie,jQuery);
//# sourceMappingURL=jquery.ui.plupload.min.js.map
